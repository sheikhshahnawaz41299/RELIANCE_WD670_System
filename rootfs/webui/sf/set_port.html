
<div class="line navi" >
  <nav >
   <div class="top-nav s-12 l-12">
    <ul>
    <li><a class="to_status"><span class="icon">&#235;</span><span class="text">STATUS</span></a></li>
    <li><a class="to_connect"><span class="icon">&#207;</span><span class="text">CONNECTION</span></a></li>
    <li><a class="to_sd" style="padding-bottom:0.5em;padding-top:0.8em;margin-bottom:0.1em;"><span class="icon" >&#229;&nbsp;</span><span class="text">WIFI DISK</span></a></li>
    <li class="active"><a class="to_setting"><span class="icon">&#216;</span><span class="text">SETTINGS</span></a></li>
    <!--<li><a class="to_smart"><span class="icon">&#201;</span><span class="text">MY SMARTFREN</span></a></li>-->
    <li><a class="to_about" style="padding-bottom:0.5em;padding-top:0.8em;"><span class="icon">&#231;</span><span class="text">ABOUT</span></a></li>            
    </ul>
  </div>

  </nav>
</div>


<div class="line width_100" >
<!-- ASIDE NAV -->
<div class="s-12 l-2" id="aside">
<div class="aside-nav" >
  <ul>
  <li id="to_setting"><a>Quick Setting</a></li>
  <li id="to_wifi"><a>WiFi Setting</a></li>
  <li id="to_net"><a>Network Setting</a></li>
  <li id="to_op"><a>Network Operators</a></li>
  <li id="to_roam" style="display:none;"><a>Roaming</a></li>
  <li id="to_sys"><a>Admin Setting</a></li>
  <li id="to_set_sd"><a>Storage Setting</a></li>
  <li><a>Advance </a>
    <ul>
    <li id="to_dhcp"><a>DHCP</a></li>
    <!--<li id="to_set_sms"><a>SMS Setting</a></li>-->
    <li id="to_set_pin" style="display:none;"><a>PIN Setting</a></li>
    <li id="to_set_mac"><a>MAC Filter</a></li>
    <li id="to_set_ip"><a>IP Filter</a></li>
    <li id="to_set_url"><a>URL Filter</a></li>
    <li id="to_set_port" class="active-item"><a href="javascript:;">Port Filter</a></li>
    <li id="to_pf"><a>Port Forward</a></li>
    <li id="to_ddns"><a>DDNS</a></li>
    <li id="to_wps"><a>WPS</a></li>
    <li id="to_wds"><a>WDS</a></li>
    <li id="to_update"><a>Update</a></li>

    </ul>
  </li>
  </ul>
</div>
</div>
<div class="s-12 l-10" id="main_content">
<h3 style="">PORT FILTER</h3>
<div class="line" >
  <form class="customform" action="#">
  <!-- <div class="margin"> -->

  <div class="s-12 l-8 line_form" style="padding-bottom:1em;">
  <div class="show_pwd">
  <label class="check">&#238;</label><label class="after">Enable Port Filter</label><input class="show_pwd_st" type="hidden" value="0" />
  </div>
  </div>
  <div class="s-12 l-8">
  <p id="p_note">The function to filter Port in the wireless local area network (WLAN),it can be used to restrict the user access to the specific internet services.</p>
  </div>
  <div class="line">
  <div class="s-12 l-8" >
  <div id="div_port_filter">
  <ul class="head" ><li class="b1">ID</li><li class="b2">Port Start</li><li class="b3">Port End</li><li class="b4">&#215;</li></ul>
  <ul class="filter" ><li class="b1">01</li><li class="b2"><input class="port" id="filter00_start" type="text"></li><li class="b3"><input class="port" id="filter00_end" type="text"></li><li class="b4">&#215;</li></ul>
  <ul class="filter" ><li class="b1">02</li><li class="b2"><input class="port" id="filter01_start" type="text"></li><li class="b3"><input class="port" id="filter01_end" type="text"></li><li class="b4">&#215;</li></ul>
  <ul class="filter" ><li class="b1">03</li><li class="b2"><input class="port" id="filter02_start" type="text"></li><li class="b3"><input class="port" id="filter02_end" type="text"></li><li class="b4">&#215;</li></ul>
  <ul class="filter" ><li class="b1">04</li><li class="b2"><input class="port" id="filter03_start" type="text"></li><li class="b3"><input class="port" id="filter03_end" type="text"></li><li class="b4">&#215;</li></ul>
  <ul class="filter" ><li class="b1">05</li><li class="b2"><input class="port" id="filter04_start" type="text"></li><li class="b3"><input class="port" id="filter04_end" type="text"></li><li class="b4">&#215;</li></ul>
  <ul class="filter" ><li class="b1">06</li><li class="b2"><input class="port" id="filter05_start" type="text"></li><li class="b3"><input class="port" id="filter05_end" type="text"></li><li class="b4">&#215;</li></ul>
  <ul class="filter" ><li class="b1">07</li><li class="b2"><input class="port" id="filter06_start" type="text"></li><li class="b3"><input class="port" id="filter06_end" type="text"></li><li class="b4">&#215;</li></ul>
  <ul class="filter" ><li class="b1">08</li><li class="b2"><input class="port" id="filter07_start" type="text"></li><li class="b3"><input class="port" id="filter07_end" type="text"></li><li class="b4">&#215;</li></ul>
  <ul class="filter" ><li class="b1">09</li><li class="b2"><input class="port" id="filter08_start" type="text"></li><li class="b3"><input class="port" id="filter08_end" type="text"></li><li class="b4">&#215;</li></ul>
  <ul class="filter" ><li class="b1">10</li><li class="b2"><input class="port" id="filter09_start" type="text"></li><li class="b3"><input class="port" id="filter09_end" type="text"></li><li class="b4">&#215;</li></ul>  
  </div>

</div>
  <div class="s-12 l-8">
  <p id="p_note">For details,see the Port Filter introduction in the Help file.</p>
  </div>
</div>


  <div class="s-12 l-8">
  <div class="s-12 l-9" id="errHint">
  </div>
  <div class="s-12 l-3 right">
  <div class="button" id="to_submit">APPLY</div>
  </div>
  </div>
  <!-- </div> -->
  </form>
  
</div>
</div>
<img src="img/loading.gif" style="display:none;">
</div>
<style type="text/css">


.width_100{width:100%;font-size:1em;}

.customform label.name{font-size: 1.2em;padding-left:2em;}
.customform label.check{font-size: 1.8em; }
.customform label.after{font-size: 1.2em; }
.customform .show_pwd{height:2em;line-height:2em;vertical-align:middle;margin-left:1.6em;}
ul{
-webkit-margin-before: 0em;
-webkit-margin-after: 0em;
-webkit-margin-start: 0px;
-webkit-margin-end: 0px;
-webkit-padding-start: 0px;
margin-left:0;
padding-left: 0;
margin-right:0;
padding-right: 0;
}

@media screen and (min-width:801px) {
#aside{height:44em;background:#F0F0F0;}
#main_content{background:#EEE;color:#444;font-size:0.9em;height:48.8em;
filter:alpha(opacity=95);  
-moz-opacity:0.95;  
-khtml-opacity: 0.95;  
opacity: 0.95;  
}
#main_content h3{padding:1em;color:#444;}
#p_note{padding-left:2em;margin-bottom:0.4em;}
#div_port_filter{padding-bottom:1em;padding-left:2em;}
}

@media screen and (max-width:800px) {
.width_100{width:100%;font-size: 1em;}
#aside{background:#F0F0F0;}
#main_content{margin-top:0.8em;background:#EEE;color:#444;font-size:0.8em;}
#main_content h3{padding:0.4em;color:#444;}
.customform label.name{font-size: 1.2em;padding-left:1em;}
#p_note{padding-left:1em;margin-bottom:1em;}
#div_port_filter{padding-bottom:1em;padding-left:1em;padding-right: 1em;}
.customform .show_pwd{margin-left:1em;}
}

ul.filter{
list-style:none;
display:inline-block;
width:100%;
border:1px solid #888; border-top:0px; 
word-wrap:break-word;word-break:break-all;
cursor:pointer;
text-align:left;
height: 1.6em;
vertical-align: middle;
background: #ddd;
color: #222;
}
.b1,.b2,.b3{float:left;height: 1.55em;line-height: 1.55em;vertical-align: middle;}
ul li.b1{width:15%;text-align: center;border-right:1px solid #888;}
ul li.b2{width:40.5%;border-right:1px solid #888;}
ul li.b3{width:40.5%;border-right:1px solid #888;}
ul li.b4{width:4%;float:left;height: 1em;text-align: center;font-size: 1.6em;margin-top: -0.1em;cursor:pointer;}
ul li.b4:hover{color:red;}
ul.head .b1,ul.head .b2,ul.head li.b3{text-align: center;}


ul.head{
list-style:none;
display:inline-block;
width:100%;
background:#34485C;border:1px solid #34485C;
line-height:  1.6em;;
text-align:left;
vertical-align: middle;
color: white;
}

 .customform input.port{font-family:dinregular,Arial,Sans-serif;height: 1.5em;border:0px solid red;-webkit-appearance: none;border-radius: 0;padding: 0 0.625em;width: 100%;margin-left: 0;}
#errHint{color: red;text-align: center;}
#waiting{text-align: center;vertical-align: middle;height: 2em;line-height: 2em;}
#waiting_txt{height: 2em;line-height: 2em;vertical-align: top;display: inline-block;}
</style>
<script type="text/javascript">

function close_pop_diag(){
easyDialog.close();
//return false;
}

function load_mark_set(){

}


function pop_submit_result(txt){
  var content = "<div class='pop_div'><div style='text-align:center;'>"+txt+"</div></div>";
  easyDialog.open({
        container : {
            header : 'Setting',
            content : content,
            yesText : 'OK',
            yesFn : close_pop_diag
        },
        callback: load_setting,
        fixed : false
    });
  return false;
}

var ios = (navigator.userAgent.match(/iPhone|iPad|iPod/) && ('ontouchstart' in document.documentElement)) ?true:false;
$('div.show_pwd').click(function(){
  if(parseInt($('input.show_pwd_st').val())) {
    if(ios) $('input.port').attr('disabled',false);
    else $('input.port').attr('disabled',true);
  }
  else {
   if(ios) $('input.port').attr('disabled',true); 
   else $('input.port').attr('disabled',false);
  }
})

function pop_waiting(txt){
  var content = "<div class='pop_div'><div id='waiting'><img src='/img/loading.gif' style='height:2em;width:2em;'><span id='waiting_txt'>"+txt+"</span></div></div>";
  easyDialog.open({
        container : {
            content : content
        },
        fixed : true
  });
}

$('#to_submit').click(function(event){
  event.preventDefault();
  $('#errHint').html('');
  var post_data=('mode='+$('input.show_pwd_st').val());
  for(i=0;i<10;i++){
    var start_id="#filter0"+i+"_start";
    var start_val = $(start_id).val();
    if(start_val.length>0 && !isInt(start_val) || (parseInt(start_val)>65535 || parseInt(start_val)<=0 ) ) 
    {
      $(start_id).focus();
      $('#errHint').html("Please Input Valid Port!");
      return false; 
    }
    var end_id="#filter0"+i+"_end";
    var end_val = $(end_id).val();
    if(end_val.length>0 && !isInt(end_val) || (parseInt(end_val)>65535 || parseInt(start_val)<=0 )) 
    {
      $(end_id).focus();
      $('#errHint').html("Please Input Valid Port!");
      return false; 
    }
    if(parseInt(end_val)<parseInt(start_val)) 
    {
      $(end_id).focus();
      $('#errHint').html("End Port Must Greater than or Equal to Start Port!");
      return false; 
    }

//    if(start_val!=''&&end_val!='') 
	post_data += ('&from'+i +'='+start_val +'&to'+i +'='+end_val);
  }
  disableButton('to_submit');
  pop_waiting('Waiting');
  locking=1;
  $.ajax({ 
    url: "/wxml/set_port.xml",
    type: "Post", 
    timeout: 8000,
    cache: false,
    datatype: "xml",
    data: post_data, 
    success: function(data, status) {
      var ret0 = parseInt($(data).find("enable").text());
      var ret1=1;
      for(var i=0;i<10;i++){
        var id='port'+i;
        if(!parseInt($(data).find(id).text())) {
          ret1=0;
          break;
        }
      }
      enableButton('to_submit');
      setTimeout(function(){
        locking=0;
        close_pop_diag();
        if(ret0&&ret1) pop_submit_result('Setting apply success!');
        else pop_submit_result('Setting apply fail!');
        load_setting();
      },3000);
    },
    error: function(x, t, m){
      if(t==="timeout"){
        locking=0;
        close_pop_diag();
      }  
    }
  })
//  pop_submit_result();
});

function refresh_data(data){
  // var dsc = $(data).find("dsc").text();
  // if(dsc&0x01) $('#to_set_pin').show();

  var filter_enable = parseInt($(data).find("enable").text());

  if(filter_enable){
    $('div.show_pwd label.check').html('&#239;');
    $('input.port').attr('disabled',false);
  }
  else {
    $('div.show_pwd label.check').html('&#238;');
    $('input.port').attr('disabled',true); 
  }
  $('input.show_pwd_st').val(filter_enable);

  $(data).find("port").each(function(index,ele){
    var start_id="#filter0"+index+"_start";
    var end_id="#filter0"+index+"_end";
    if($(ele).text()!='0' && $(ele).text()!='-'){
      var port=$(ele).text().split(',');
      $(start_id).val(port[0]);
      $(end_id).val(port[1]);
    }
    else {
      $(start_id).val('');
      $(end_id).val('');
    }
  })
}
$('ul.filter li:last-child').die().live('click',function(){
  $(this).parent().find('input').val('');
})

$('ul.head li:last-child').die().live('click',function(){
  $(this).parent().parent().find('input').val('');
})

function load_setting(){
  if(locking) return true;
  $("#errHint").html('');
  $.ajax({ 
    url: "mark_set_port.w.xml",
    type: "Get", 
    timeout: 8000,
    cache: false,
    datatype: "xml",
//    data: { path:curr_path,page:curr_page,filter:'255'  }, 
    success: function(data, status) {
      refresh_data(data);
    },
    error: function(x, t, m){
      if(t==="timeout"){

      }  
    }
  })
}

function load_mark(url){
var dsc=parseInt(<% get_version_dsc(); %>);
if(dsc&0x01) $('#to_set_pin').show();
if(dsc&0x02){
  $('#to_roam').show();
}
  if(interval_timer) clearInterval(interval_timer);
  if(url=="set_port.html"){
    load_setting();
  }
}

</script>


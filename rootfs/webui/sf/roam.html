
<div class="line navi" >
  <nav >
   <div class="top-nav s-12 l-12">
    <ul>
    <li><a class="to_status"><span class="icon">&#235;</span><span class="text">STATUS</span></a></li>
    <li><a class="to_connect"><span class="icon">&#207;</span><span class="text">CONNECTION</span></a></li>
    <li><a class="to_sd" style="padding-bottom:0.5em;padding-top:0.8em;margin-bottom:0.1em;"><span class="icon" >&#229;&nbsp;</span><span class="text">WIFI DISK</span></a></li>
    <li class="active"><a class="to_setting"><span class="icon">&#216;</span><span class="text">SETTINGS</span></a></li>
    <!--<li><a class="to_smart"><span class="icon">&#201;</span><span class="text">MY SMARTFREN</span></a></li>-->
    <li><a class="to_about" style="padding-bottom:0.5em;padding-top:0.8em;"><span class="icon">&#231;</span><span class="text">ABOUT</span></a></li>            
    </ul>
  </div>

  </nav>
</div>


<div class="line width_100" >
<!-- ASIDE NAV -->
<div class="s-12 l-2" id="aside">
<div class="aside-nav" >
  <ul>
  <li id="to_setting"><a>Quick Setting</a></li>
  <li id="to_wifi"><a>WiFi Setting</a></li>
  <li id="to_net"><a>Network Setting</a></li>
  <li id="to_op"><a>Network Operators</a></li>
  <li id="to_roam" class="active-item "><a href="javascript:;">Roaming</a></li>
  <li id="to_sys"><a>Admin Setting</a></li>
  <li id="to_set_sd"><a>Storage Setting</a></li>
  <li><a>Advance </a>
    <ul>
    <li id="to_dhcp"><a>DHCP</a></li>
    <!--<li id="to_set_sms"><a>SMS Setting</a></li>-->
    <li id="to_set_pin" style="display:none;"><a>PIN Setting</a></li>
    <li id="to_set_mac"><a>MAC Filter</a></li>
    <li id="to_set_ip"><a>IP Filter</a></li>
    <li id="to_set_url"><a>URL Filter</a></li>
    <li id="to_set_port"><a>Port Filter</a></li>
    <li id="to_pf"><a>Port Forward</a></li>
    <li id="to_ddns"><a>DDNS</a></li>
    <li id="to_wps"><a>WPS</a></li>
    <li id="to_wds"><a>WDS</a></li>
    <li id="to_update"><a>Update</a></li>

    </ul>
  </li>
  </ul>
</div>
</div>
<div class="s-12 l-10" id="main_content">
<h3 style="">ROAMING</h3>
<div class="line" style="padding:0em 0.6em;" id="div_content">
  <form class="customform" action="#">
  <div class="margin">




  <div class="line">
  <div class="s-12 l-3 line_form">
  <label class="name"> Roaming Mode</label>
  </div>
  <div class="s-12 l-5 line_form">
    <input type="radio" name="stk_roam" value="4" /><label class="radio">National</label>
    <input type="radio" name="stk_roam" value="5" /><label class="radio">International</label>
  </div>
  </div>

  <div class="s-12 l-8">
  <div class="s-12 l-9" id="errHint">
  </div>
  <div class="s-12 l-3 right">
  <div class="button" id="to_submit">APPLY</div>
  </div>
  </div>
  </div>
  </form>
  
</div>
</div>
<img src="img/loading.gif" style="display:none;">
</div>
<style type="text/css">


.width_100{width:100%;font-size:1em;}

.customform label.name{font-size: 1.2em;padding-left:2em;}
.customform label.check{font-size: 1.8em; }
.customform label.after{font-size: 1em; }
.customform .show_pwd{height:2.7em;line-height:2.7em;vertical-align:middle;margin-left:1.6em;}

fieldset{border:1px solid #999;margin-left:2em; margin-bottom:1.6em;font-size:1em;}
legend{font-size:1.2em;border:0px solid #999;padding:0.2em 0.4em;background:#2088B0;color:white;}
@media screen and (min-width:801px) {
#aside{height:55em;background:#F0F0F0;}
#main_content{background:#EEE;color:#444;font-size:0.9em;height:61em;
filter:alpha(opacity=95);  
-moz-opacity:0.95;  
-khtml-opacity: 0.95;  
opacity: 0.95;  
}
#main_content h3{padding:1em;color:#444;}
}

@media screen and (max-width:800px) {
.width_100{width:100%;font-size: 1em;}
#aside{background:#F0F0F0;}
#main_content{margin-top:0.8em;background:#EEE;color:#444;font-size:0.8em;}
#main_content h3{padding:0.4em;color:#444;}
.customform label.name{font-size: 1.2em;padding-left:1em;}
fieldset{border:1px solid #999;margin-left:1em; margin-bottom:1.6em;margin-right: 1em;font-size:1em;}
legend{font-size:1.4em;padding:0.2em 0.4em;}
}
#errHint{color: red;text-align: center;}
#waiting{text-align: center;vertical-align: middle;height: 2em;line-height: 2em;}
#waiting_txt{height: 2em;line-height: 2em;vertical-align: top;display: inline-block;}
</style>
<script type="text/javascript">

function close_pop_diag(){
locking=0;
easyDialog.close();
return false;
}

function load_mark_set(){

}
function pop_confirm(txt){
  locking=1;
  var content = "<div class='pop_div'><div style='text-align:center;'>"+txt+"</div></div>";
  easyDialog.open({
        container : {
            header : 'Setting',
            content : content,
            yesText : 'OK',
            yesFn : submit_net,
            noText : 'Cancel',
            noFn : close_pop_diag
        },
        fixed : false
    });
}
function pop_waiting(txt){
  locking=1;
  var content = "<div class='pop_div'><div id='waiting'><img src='/img/loading.gif' style='height:2em;width:2em;'><span id='waiting_txt'>"+txt+"</span></div></div>";
  easyDialog.open({
        container : {
            content : content
        },
        fixed : true
  });
}
function pop_submit_result(txt){
  var content = "<div class='pop_div'><div style='text-align:center;'>"+txt+"</div></div>";
  easyDialog.open({
        container : {
            header : 'Setting',
            content : content,
            yesText : 'OK',
            yesFn : close_pop_diag
        },
        callback: reload_setting,
        fixed : false
    });
}


$('#to_submit').click(function(event){
  event.preventDefault();
if(locking) {
    close_pop_diag();
    setTimeout(function(){
      pop_waiting('Waiting');  
    },300);
  }
  else{
    pop_waiting('Waiting');
  }
  $("#errHint").html('');
  
  locking=1;

  
  var post_data='';
  
  if(!$('input[name=stk_roam]').prop("disabled")){
    var stk_roam = parseInt($('input[name=stk_roam]:checked').val());
    if(stk_roam==4) stk_roam=2;
    else if(stk_roam==5) stk_roam=3;
    else{
      stk_roam=0;
    }
    post_data+=('stk_roam='+stk_roam);
  }
  else{
    pop_submit_result("Roaming mode disabled.");
    load_stk_times=0;
    return;
  }

    $.ajax({ 
      url: "/wxml/set_stk.xml",
      type: "Post", 
      timeout: 20000,
      cache: false,
      datatype: "xml",
      data: post_data, 
      success: function(data, status) {
        locking=0;
        var ret0 = parseInt($(data).find("stk_roam").text());
        
        if(!ret0) pop_submit_result('Setting apply success!');
        else pop_submit_result('Setting apply fail!');
        load_stk_times=0;
//        load_setting();
      },
      error: function(x, t, m){
        if(t==="timeout"){
          locking=0;
          close_pop_diag();
        }  
      }
    })
  
});




function reload_setting(){
  locking=0;
  setTimeout(load_setting,1000);
}




function load_setting(){
  if(load_stk_times==0){
    $("#errHint").html('');  
    pop_waiting('Waiting');
    locking=1;
  }
  load_stk_times++;
  $.ajax({ 
    url: "mark_set_stk.w.xml",
    type: "Get", 
    timeout: 18000,
    cache: false,
    datatype: "xml",
    success: function(data, status) {
      var stk_roam=parseInt($(data).find("stk_roam").text());
      if(stk_roam!=4 && stk_roam!=5){
        $('input[name=stk_roam]').attr("disabled","true");
        if(load_stk_times<3) load_setting();
        else {
          close_pop_diag();
        }
      }
      else{
        close_pop_diag();
        $('input[name=stk_roam]').attr("disabled",false).eq(stk_roam-4).attr('checked',"checked");
      }

      // var dsc = $(data).find("dsc").text();
      // if(dsc&0x01) $('#to_set_pin').show();

      refresh_height();
    },
    error: function(x, t, m){
      $('input[name=stk_roam]').attr("disabled","true");
        if(load_stk_times<3) load_setting();
        else {
          close_pop_diag();
        }
      if(t==="timeout"){

      }  
    }
  })
}



var load_stk_times=0;
function load_mark(url){
var dsc=parseInt(<% get_version_dsc(); %>);
if(dsc&0x01) $('#to_set_pin').show();
if(dsc&0x02){
  $('#to_roam').show();
}
  if(interval_timer) clearInterval(interval_timer);
  if(url=="roam.html"){
    load_stk_times=0;
    load_setting();
  }
}

function refresh_height(){
  var c_height;
    var s_height=$('div.aside-nav').height();
    if($('#div_content').height() +100> s_height){
      c_height = $('#div_content').height()+100;
    }
    else c_height=s_height;



    $('#main_content').height(c_height);
    if($(document).width()>800) $('#aside').height(c_height);
    else $('#aside').height($('.aside-nav').height());
}




</script>


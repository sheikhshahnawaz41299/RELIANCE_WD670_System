<div class="line navi" >
  <nav >
   <div class="top-nav s-12 l-12">
    <ul>
    <li><a class="to_status"><span class="icon">&#235;</span><span class="text">STATUS</span></a></li>
    <li><a class="to_connect"><span class="icon">&#207;</span><span class="text">CONNECTION</span></a></li>
    <li><a class="to_sd" style="padding-bottom:0.5em;padding-top:0.8em;margin-bottom:0.1em;"><span class="icon" >&#229;&nbsp;</span><span class="text">WIFI DISK</span></a></li>
    <li class="active"><a class="to_setting"><span class="icon">&#216;</span><span class="text">SETTINGS</span></a></li>
    <!--<li><a class="to_smart"><span class="icon">&#201;</span><span class="text">MY SMARTFREN</span></a></li>-->
    <li><a class="to_about" style="padding-bottom:0.5em;padding-top:0.8em;"><span class="icon">&#231;</span><span class="text">ABOUT</span></a></li>            
    </ul>
  </div>

  </nav>
</div>

<div class="line width_100" >
<!-- ASIDE NAV -->
<div class="s-12 l-2" id="aside">
<div class="aside-nav" >
  <ul>
  <li id="to_setting"><a>Quick Setting</a></li>
  <li id="to_wifi"><a>WiFi Setting</a></li>
  <li id="to_net"><a>Network Setting</a></li>
  <li id="to_op"><a>Network Operators</a></li>
  <li id="to_roam" style="display:none;"><a>Roaming</a></li>
  <li id="to_sys"><a>Admin Setting</a></li>
  <li id="to_set_sd"><a>Storage Setting</a></li>
  <li><a>Advance </a>
    <ul>
    <li id="to_dhcp"><a>DHCP</a></li>
    <!--<li id="to_set_sms"><a>SMS Setting</a></li>-->
    <li id="to_set_pin" style="display:none;"><a>PIN Setting</a></li>
    <li id="to_set_mac"><a>MAC Filter</a></li>
    <li id="to_set_ip"><a>IP Filter</a></li>
    <li id="to_set_url"><a>URL Filter</a></li>
    <li id="to_set_port"><a>Port Filter</a></li>
    <li id="to_pf"><a>Port Forward</a></li>
    <li id="to_ddns" class="active-item"><a href="javascript:;">DDNS</a></li>
		<li id="to_wps"><a>WPS</a></li>
    <li id="to_wds"><a>WDS</a></li>
    <li id="to_update"><a>Update</a></li>
    </ul>
  </li>
  </ul>
</div>
</div>
<div class="s-12 l-10" id="main_content">
<h3 style="">DDNS</h3>
<div class="line" style="padding:0em 0.6em;">
  <form class="customform" action="#">
  <div class="margin">
  
  <div class="s-12 l-8 line_form" style="padding-bottom:1em;padding-left:1em;">
  <div class="ud_check">
  <label class="check">&#238;</label><label class="after">Enable DDNS</label><input class="ud_check_st" type="hidden" value="0" />
  </div>
  </div>
  <div class="s-12 l-8">
  <p id="p_note">It is a method of updating,in real time,a Domain Name System to point to a changing IP address on the Internet.This is used to provide a persistent domain name for a resource that may change location on the network.</p>
  </div>
  <div class="line">
  <div class="s-12 l-3 line_form">
  <label class="name">Server</label>
  </div>
  <div class="s-12 l-5">
    <select name="server">
    <option selected value="no-ip.com">no-ip.com</option>
    <option value="dyndns.com">dyndns.com</option>
    <option value="oray.com">oray.com</option>
    </select>
  </div>
  </div>

  <div class="line">
  <div class="s-12 l-3 line_form">
  <label class="name"> Domain</label>
  </div>
  <div class="s-12 l-5">
  <input type="text" name="domain" title="domain" placeholder="DOMAIN" value="domain.no-ip.com" />
  </div>
  </div>

  <div class="line">
  <div class="s-12 l-3 line_form">
  <label class="name">Username</label>
  </div>
  <div class="s-12 l-5">
  <input type="text" name="user" title="USERNAME" placeholder="USERNAME" value="" />
  </div>
  </div>

  <div class="line">
  <div class="s-12 l-3 line_form">
  <label class="name">Password</label>
  </div>
  <div class="s-12 l-5">
  <input type="password" id="pwd" name="pwd" title="PASSWORD" placeholder="PASSWORD" value="12345678" /> 
  </div>
  <div class="s-12 l-4">
    <div class="show_pwd" for="pwd">
    <label class="check">&#238;</label><label class="after">Show Password</label> <input class="show_pwd_st" type="hidden" value="0" />
    </div>
  </div>
  </div>

  <div class="line">
  <div class="s-12 l-3 line_form">
  <label class="name">DDNS State</label>
  </div>
  <div class="s-6 l-3 line_form">
  <span id="state">Idle</span>
  </div>
  <div class="s-6 l-3 line_form">
  <span style="color:blue;" id="ddns_ip_addr"></span>
  </div>
  </div>

  <div class="s-12 l-8">
  <div class="s-12 l-9" id="errHint">
  </div>
  <div class="s-12 l-3 right">
  <div class="button" id="to_submit">APPLY</div>
  </div>
  </div>
  </div>
  </form>
  
</div>
</div>
</div>
<style type="text/css">
.width_100{width:100%;font-size:1em;}

.customform label.name{font-size: 1.2em;padding-left:2em;}
.customform label.check{font-size: 1.8em; }
.customform label.after{font-size: 1.2em; }
.customform .show_pwd,.customform .ud_check{height:2.7em;line-height:2.7em;vertical-align:middle;margin-left:1.6em;}


@media screen and (min-width:801px) {
#aside{height:44em;background:#F0F0F0;}
#main_content{background:#EEE;color:#444;font-size:0.9em;height:48.8em;
filter:alpha(opacity=95);  
-moz-opacity:0.95;  
-khtml-opacity: 0.95;  
opacity: 0.95;  
}
#main_content h3{padding:1em;color:#444;}
#p_note{padding-left:2em;margin-bottom:0.4em;}
}

@media screen and (max-width:800px) {
.width_100{width:100%;font-size: 1em;}
#aside{background:#F0F0F0;}
#main_content{margin-top:0.8em;background:#EEE;color:#444;font-size:0.8em;}
#main_content h3{padding:0.4em;color:#444;}
.customform label.name{font-size: 1.2em;padding-left:1em;}
#state{padding-left: 1em;}
#p_note{padding-left:1em;margin-bottom:0.4em;}
}

#errHint{color: red;text-align: center;}
</style>
<script type="text/javascript">

function close_pop_diag(){
easyDialog.close();
//return false;
}

function load_mark_set(){

}


function pop_submit_result(txt){
  var content = "<div class='pop_div'><div style='text-align:center;'>"+txt+"</div></div>";
  easyDialog.open({
        container : {
            header : 'Setting',
            content : content,
            yesText : 'OK',
            yesFn : close_pop_diag
        },
        callback: load_setting,
        fixed : false
    });
  return false;
}


$('div.ud_check').click(function(){
  if(parseInt($('input.ud_check_st').val())) {
    $('input[type=text],input[type=password],select').attr('disabled',true);
      $('input.ud_check_st').val(0)
      $(this).children("label:eq(0)").html('&#238;');
  }
  else {
    $('input[type=text],input[type=password],select').attr('disabled',false);
    $('input.ud_check_st').val(1)
    $(this).children("label:eq(0)").html('&#239;');
  }
})

$('#to_submit').click(function(event){
  event.preventDefault();
  $('#errHint').html('');
  var post_data=('enable='+$('input.ud_check_st').val());

  post_data+= ('&server='+$('select[name=server]').val()+'&domain='+esc($('input[name=domain]').val())+ '&username='+esc($('input[name=user]').val())+ '&password='+ esc($('input[name=pwd]').val()));

  $.ajax({ 
    url: "/wxml/set_ddns.xml",
    type: "Post", 
    timeout: 8000,
    cache: false,
    datatype: "xml",
    data: post_data, 
    success: function(data, status) {
      var enable = parseInt($(data).find("enable").text());
      var set0=parseInt($(data).find("set0").text())
      var set1=parseInt($(data).find("set1").text())
      var set2=parseInt($(data).find("set2").text())
      var set3=parseInt($(data).find("set3").text())

      if(enable&&set0&&set1&&set2&&set3) pop_submit_result('Setting apply success!');
      else pop_submit_result('Setting apply fail!');
      inited=0;
    },
    error: function(x, t, m){
      if(t==="timeout"){

      }  
    }
  })
//  pop_submit_result();
});

var inited=0;
function refresh_data(data){
  if(inited==0){
    var enable_ddns=parseInt($(data).find("ddns_enable").text());
    if(enable_ddns){
      $('div.ud_check label.check').html('&#239;');
      $('input[type=text],input[type=password],select').attr('disabled',false);
    }
    else{
      $('div.ud_check label.check').html('&#238;');
      $('input[type=text],input[type=password],select').attr('disabled',true);
    }
    $('input.ud_check_st').val(enable_ddns);
    var server=$(data).find("server").text();
    $('select[name=server]').val(server);

    var domain=$(data).find("domain").text();
    if(domain=='-') domain='';
    $('input[name=domain]').val(domain);

    var ddns_user=$(data).find("ddns_user").text();
    if(ddns_user=='-') ddns_user='';
    $('input[name=user]').val(ddns_user);

    var ddns_pwd=$(data).find("ddns_pwd").text();
    if(ddns_pwd=='-') ddns_pwd='';
    $('input[name=pwd]').val(ddns_pwd);
    inited=1;
  }
  var ddns_state_str;
  var state=$(data).find("ddns_state").text();
  if(state==0) ddns_state_str="Idle";
  else if(state==1 || state==2) ddns_state_str="Updating";
  else if(state==3) ddns_state_str="OK";
  else if(state==4) ddns_state_str="Block";
  $('#state').html(ddns_state_str);

  var ddns_ip_addr=$(data).find("ddns_ip_addr").text();
  if(state!=0 && state!=4){
  $('#ddns_ip_addr').html(ddns_ip_addr);  
  }
  else $('#ddns_ip_addr').html('');
}

function load_setting(){
//  $("#errHint").html('');
  $.ajax({ 
    url: "mark_set_ddns.w.xml",
    type: "Get", 
    timeout: 8000,
    cache: false,
    datatype: "xml",
//    data: { path:curr_path,page:curr_page,filter:'255'  }, 
    success: function(data, status) {
      refresh_data(data);
    },
    error: function(x, t, m){
      if(t==="timeout"){

      }  
    }
  })
}




function load_mark(url){
var dsc=parseInt(<% get_version_dsc(); %>);
if(dsc&0x01) $('#to_set_pin').show();
if(dsc&0x02){
  $('#to_roam').show();
}

  if(interval_timer) clearInterval(interval_timer);
  if(url=="ddns.html"){
    load_setting();
    interval_timer = setInterval(load_setting,1000);
  }
}

</script>

